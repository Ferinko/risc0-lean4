# risc0-lean4

> :warning: **This repository contains research artifacts. It is a work in progress and should not be used for any purpose.**

*[risc0-lean4](https://github.com/risc0/risc0-lean4)* is a formal model of the [RISC Zero zkVM](https://www.github.com/risc0/risc0), written in the [Lean Theorem Prover](https://leanprover.github.io/). Its long-term goal is to support formal security and soundness proofs for the RISC Zero ecosystem.


## Features

* [x] ELF file handling
* [x] RV32IM emulation
* [x] SHA2-256
* [x] Merkle tree parsing and inclusion proof verification
* [x] The Baby Bear field (and its degree 4 extension)
* [x] FRI verification
* [x] Arithmetic circuit parsing and evaluation
* [x] zkVM receipt parsing and verification


## Repo Organization
- Main verification logic 
  - Lean version: [Verify.lean](https://github.com/risc0/risc0-lean4/blob/main/Zkvm/Verify.lean) 
  - Rust version: [verify/mod.rs](https://github.com/risc0/risc0/tree/main/risc0/zkp/src/verify/mod.rs) 
- Merkle verification
  - Lean version: [Merkle.lean](https://github.com/risc0/risc0-lean4/blob/main/Zkvm/Verify/Merkle.lean) 
  - Rust version: [verify/merkle.rs](https://github.com/risc0/risc0/blob/main/risc0/zkp/src/verify/merkle.rs)
- FRI verification
  - Lean version: [Fri.lean](https://github.com/risc0/risc0-lean4/blob/main/Zkvm/Seal/Fri.lean)
  - Rust version: [verify/fri.rs](https://github.com/risc0/risc0/blob/main/risc0/zkp/src/verify/fri.rs) 


## Compatibility

This repository trails behind the [zkVM repository](https://www.github.com/risc0/risc0). Precise version information can be found in [Cargo.lock](https://github.com/risc0/risc0-lean4/blob/main/rust/Cargo.lock).


## Building

### Getting Lean4

See the [Quickstart guide](https://leanprover.github.io/lean4/doc/quickstart.html).

### Performing the build

First, check to see if `lake` is in your terminal's search path. If not, you either haven't installed Lean4 yet, or you haven't `source`'d the `elan` environment variables.

```console
risc0-lean4$ source ~/.elan/env
```

Now you can perform the build:

```console
risc0-lean4$ lake build
```

## Running the tools

This repository includes various executables. These executables are currently used for testing, but will eventually be expanded to provide greater utility.

### Receipt verifier

Verify a receipt generated by the zkVM:

```console
risc0-lean4$ ./build/bin/zkvm-verify-lean4
```

### zkVM emulator

Run a zkVM guest (without proof):

```console
risc0-lean4$ ./build/bin/zkvm-emu-lean4
```

### Elf dumper

Read the headers of an ELF binary:

```console
risc0-lean4$ ./build/bin/elf-dump-lean4
```

## Building the docs

```console
$ lake -Kdoc=on update
$ lake -Kdoc=on build Zkvm:docs
```

The docs will be viewable at `build/doc/index.html`.
